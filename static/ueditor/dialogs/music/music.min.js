function Music(){this.init()}(function(){var k=[],l=[],e=null;Music.prototype={total:70,pageSize:10,dataUrl:"http://tingapi.ting.baidu.com/v1/restserver/ting?method\x3dbaidu.ting.search.common",playerUrl:"http://box.baidu.com/widget/flash/bdspacesong.swf",init:function(){var a=this;domUtils.on($G("J_searchName"),"keyup",function(b){13==(window.event||b).keyCode&&a.dosearch()});domUtils.on($G("J_searchBtn"),"click",function(){a.dosearch()})},callback:function(a){var b=this;b.data=a.song_list;setTimeout(function(){$G("J_resultBar").innerHTML=b._renderTemplate(a.song_list)},300)},dosearch:function(){e=null;var a=$G("J_searchName").value;if(""==utils.trim(a))return!1;a=encodeURIComponent(a);this._sent(a)},doselect:function(a){"object"==typeof a?e=a:"number"==typeof a&&(e=this.data[a])},onpageclick:function(a){for(var b=0;b<k.length;b++)$G(k[b]).className="pageoff",$G(l[b]).className="paneloff";$G("page"+a).className="pageon";$G("panel"+a).className="panelon"},listenTest:function(a){var b=$G("J_preview"),f="m-try"==a.className,d=this._getTryingElem();d&&(d.className="m-try",b.innerHTML="");f&&(a.className="m-trying",b.innerHTML=this._buildMusicHtml(this._getUrl(!0)))},_sent:function(a){$G("J_resultBar").innerHTML='\x3cdiv class\x3d"loading"\x3e\x3c/div\x3e';utils.loadFile(document,{src:this.dataUrl+"\x26query\x3d"+a+"\x26page_size\x3d"+this.total+"\x26callback\x3dmusic.callback\x26.r\x3d"+Math.random(),tag:"script",type:"text/javascript",defer:"defer"})},_removeHtml:function(a){return a.replace(/<\s*\/?\s*[^>]*\s*>/gi,"")},_getUrl:function(a){a="from\x3dtiebasongwidget\x26url\x3d\x26name\x3d"+encodeURIComponent(this._removeHtml(e.title))+"\x26artist\x3d"+encodeURIComponent(this._removeHtml(e.author))+"\x26extra\x3d"+encodeURIComponent(this._removeHtml(e.album_title))+"\x26autoPlay\x3d"+a+"\x26loop\x3dtrue";return this.playerUrl+"?"+a},_getTryingElem:function(){for(var a=$G("J_listPanel").getElementsByTagName("span"),b=0;b<a.length;b++)if("m-trying"==a[b].className)return a[b];return null},_buildMusicHtml:function(a){a='\x3cembed class\x3d"BDE_try_Music" allowfullscreen\x3d"false" pluginspage\x3d"http://www.macromedia.com/go/getflashplayer"'+(' src\x3d"'+a+'"')+' width\x3d"1" height\x3d"1" style\x3d"position:absolute;left:-2000px;" type\x3d"application/x-shockwave-flash" wmode\x3d"transparent" play\x3d"true" loop\x3d"false"';return a+=' menu\x3d"false" allowscriptaccess\x3d"never" scale\x3d"noborder"\x3e'},_byteLength:function(a){return a.replace(/[^\u0000-\u007f]/g,"aa").length},_getMaxText:function(a){a=this._removeHtml(a);if(12<this._byteLength(a))return a.substring(0,5)+"...";a||(a="\x26nbsp;");return a},_rebuildData:function(a){for(var b=[],f=this.pageSize,d,c=0;c<a.length;c++)0==(c+f)%f&&(d=[],b.push(d)),d.push(a[c]);return b},_renderTemplate:function(a){if(0==a.length)return'\x3cdiv class\x3d"empty"\x3e'+lang.emptyTxt+"\x3c/div\x3e";a=this._rebuildData(a);var b=[],f=[],d=[];b.push('\x3cdiv id\x3d"J_listPanel" class\x3d"listPanel"\x3e');f.push('\x3cdiv class\x3d"page"\x3e');for(var c=0,e;e=a[c++];){l.push("panel"+c);k.push("page"+c);1==c?(b.push('\x3cdiv id\x3d"panel'+c+'" class\x3d"panelon"\x3e'),1!=a.length&&d.push('\x3cdiv id\x3d"page'+c+'" onclick\x3d"music.onpageclick('+c+')" class\x3d"pageon"\x3e'+c+"\x3c/div\x3e")):(b.push('\x3cdiv id\x3d"panel'+c+'" class\x3d"paneloff"\x3e'),d.push('\x3cdiv id\x3d"page'+c+'" onclick\x3d"music.onpageclick('+c+')" class\x3d"pageoff"\x3e'+c+"\x3c/div\x3e"));b.push('\x3cdiv class\x3d"m-box"\x3e');b.push('\x3cdiv class\x3d"m-h"\x3e\x3cspan class\x3d"m-t"\x3e'+lang.chapter+'\x3c/span\x3e\x3cspan class\x3d"m-s"\x3e'+lang.singer+'\x3c/span\x3e\x3cspan class\x3d"m-z"\x3e'+lang.special+'\x3c/span\x3e\x3cspan class\x3d"m-try-t"\x3e'+lang.listenTest+"\x3c/span\x3e\x3c/div\x3e");for(var g=0,h;h=e[g++];)b.push('\x3clabel for\x3d"radio-'+c+"-"+g+'" class\x3d"m-m"\x3e'),b.push('\x3cinput type\x3d"radio" id\x3d"radio-'+c+"-"+g+'" name\x3d"musicId" class\x3d"m-l" onclick\x3d"music.doselect('+(this.pageSize*(c-1)+(g-1))+')"/\x3e'),b.push('\x3cspan class\x3d"m-t"\x3e'+this._getMaxText(h.title)+"\x3c/span\x3e"),b.push('\x3cspan class\x3d"m-s"\x3e'+this._getMaxText(h.author)+"\x3c/span\x3e"),b.push('\x3cspan class\x3d"m-z"\x3e'+this._getMaxText(h.album_title)+"\x3c/span\x3e"),b.push('\x3cspan class\x3d"m-try" onclick\x3d"music.doselect('+(this.pageSize*(c-1)+(g-1))+');music.listenTest(this)"\x3e\x3c/span\x3e'),b.push("\x3c/label\x3e");b.push("\x3c/div\x3e");b.push("\x3c/div\x3e")}d.reverse();f.push(d.join(""));b.push("\x3c/div\x3e");f.push("\x3c/div\x3e");return b.join("")+f.join("")},exec:function(){null!=e&&($G("J_preview").innerHTML="",editor.execCommand("music",{url:this._getUrl(!1),width:400,height:95}))}}})();