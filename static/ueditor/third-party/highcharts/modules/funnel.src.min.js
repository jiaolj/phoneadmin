/**
 * @license 
 * Highcharts funnel module, Beta
 *
 * (c) 2010-2012 Torstein Hønsi
 *
 * License: www.highcharts.com/license
 */

/*global Highcharts *//*
 
 Highcharts funnel module, Beta

 (c) 2010-2012 Torstein Hønsi

 License: www.highcharts.com/license
*/
(function(d){var y=d.getOptions().plotOptions,t=d.seriesTypes,H=d.merge,D=function(){},E=d.each;y.funnel=H(y.pie,{center:["50%","50%"],width:"90%",neckWidth:"30%",height:"100%",neckHeight:"25%",dataLabels:{connectorWidth:1,connectorColor:"#606060"},size:!0,states:{select:{color:"#C0C0C0",borderColor:"#000000",shadow:!1}}});t.funnel=d.extendClass(t.pie,{type:"funnel",animate:D,translate:function(){var a=function(m,a){return/%$/.test(m)?a*parseInt(m,10)/100:parseInt(m,10)},g=0,e=this.chart,f=e.plotWidth,e=e.plotHeight,h=0,c=this.options,G=c.center,b=a(G[0],f),d=a(G[0],e),t=a(c.width,f),k,u,l=a(c.height,e),v=a(c.neckWidth,f),w=a(c.neckHeight,e),z=l-w,a=this.data,A,B,y="left"===c.dataLabels.position?1:0,C,p,F,q,n,x,r;this.getWidthAt=u=function(m){return m>l-w||l===w?v:v+(l-w-m)/(l-w)*(t-v)};this.getX=function(m,a){return b+(a?-1:1)*(u(m)/2+c.dataLabels.distance)};this.center=[b,d,l];this.centerX=b;E(a,function(a){g+=a.y});E(a,function(a){r=null;B=g?a.y/g:0;p=d-l/2+h*l;n=p+B*l;k=u(p);C=b-k/2;F=C+k;k=u(n);q=b-k/2;x=q+k;p>z?(C=q=b-v/2,F=x=b+v/2):n>z&&(r=n,k=u(z),q=b-k/2,x=q+k,n=z);A=["M",C,p,"L",F,p,x,n];r&&A.push(x,r,q,r);A.push(q,n,"Z");a.shapeType="path";a.shapeArgs={d:A};a.percentage=100*B;a.plotX=b;a.plotY=(p+(r||n))/2;a.tooltipPos=[b,a.plotY];a.slice=D;a.half=y;h+=B});this.setTooltipPoints()},drawPoints:function(){var a=this,g=a.options,e=a.chart.renderer;E(a.data,function(f){var h=f.graphic,c=f.shapeArgs;h?h.animate(c):f.graphic=e.path(c).attr({fill:f.color,stroke:g.borderColor,"stroke-width":g.borderWidth}).add(a.group)})},sortByAngle:D,drawDataLabels:function(){var a=this.data,g=this.options.dataLabels.distance,e,f,h,c=a.length,d,b;for(this.center[2]-=2*g;c--;)h=a[c],f=(e=h.half)?1:-1,b=h.plotY,d=this.getX(b,e),h.labelPos=[0,b,d+(g-5)*f,b,d+g*f,b,e?"right":"left",0];t.pie.prototype.drawDataLabels.call(this)}})})(Highcharts);