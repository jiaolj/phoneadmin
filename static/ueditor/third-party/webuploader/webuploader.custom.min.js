/*! WebUploader 0.1.2 */


/**
 * @fileOverview 让内部各个部件的代码可以用[amd](https://github.com/amdjs/amdjs-api/wiki/AMD)模块定义方式组织起来。
 *
 * AMD API 内部的简单不完全实现，请忽略。只有当WebUploader被合并成一个文件的时候才会引入。
 */(function(n,l){var E={},k=function(b,a){var f,d,e;if("string"===typeof b)return g(b);f=[];d=b.length;for(e=0;e<d;e++)f.push(g(b[e]));return a.apply(null,f)},g=function(b){var a=E[b]||n[b];if(!a)throw Error("`"+b+"` is undefined");return a},h=l(n,function(b,a,f){2===arguments.length&&(f=a,a=null);k(a||[],function(){var a=arguments,e={exports:f};"function"===typeof f&&(a.length||(a=[k,e.exports,e]),a=f.apply(null,a),void 0!==a&&(e.exports=a));E[b]=e.exports})},k),c;(function(b){var a,f,d,e,m,c;c=function(a){return a&&a.charAt(0).toUpperCase()+a.substr(1)};for(a in E)if(f=b,E.hasOwnProperty(a)){d=a.split("/");for(m=c(d.pop());e=c(d.shift());)f[e]=f[e]||{},f=f[e];f[m]=E[a]}})(h);"object"===typeof module&&"object"===typeof module.exports?module.exports=h:"function"===typeof define&&define.amd?define([],h):(c=n.WebUploader,n.WebUploader=h,n.WebUploader.noConflict=function(){n.WebUploader=c})})(this,function(n,l,E){l("dollar-third",[],function(){return n.jQuery||n.Zepto});l("dollar",["dollar-third"],function(k){return k});l("promise-third",["dollar"],function(k){return{Deferred:k.Deferred,when:k.when,isPromise:function(k){return k&&"function"===typeof k.then}}});l("promise",["promise-third"],function(k){return k});l("base",["dollar","promise"],function(k,g){function h(a,e){return function(){return a.apply(e,arguments)}}function c(a){var e;if(Object.create)return Object.create(a);e=function(){};e.prototype=a;return new e}var b=function(){},a=Function.call,f=g.Deferred,d=g.isPromise,e=g.when,m=function(a){var e={},b=a.match(/WebKit\/([\d.]+)/),m=a.match(/Chrome\/([\d.]+)/)||a.match(/CriOS\/([\d.]+)/),f=a.match(/MSIE\s([\d\.]+)/)||a.match(/(?:trident)(?:.*rv:([\w.]+))?/i),d=a.match(/Firefox\/([\d.]+)/),c=a.match(/Safari\/([\d.]+)/);a=a.match(/OPR\/([\d.]+)/);b&&(e.webkit=parseFloat(b[1]));m&&(e.chrome=parseFloat(m[1]));f&&(e.ie=parseFloat(f[1]));d&&(e.firefox=parseFloat(d[1]));c&&(e.safari=parseFloat(c[1]));a&&(e.opera=parseFloat(a[1]));return e}(navigator.userAgent),p=function(a){var e={},b=a.match(/(?:Android);?[\s\/]+([\d.]+)?/);a=a.match(/(?:iPad|iPod|iPhone).*OS\s([\d_]+)/);b&&(e.android=parseFloat(b[1]));a&&(e.ios=parseFloat(a[1].replace(/_/g,".")));return e}(navigator.userAgent),M;M=n.console?h(console.log,console):b;return{version:"0.1.2",$:k,Deferred:f,isPromise:d,when:e,browser:m,os:p,inherits:function(a,e,b){var m;"function"===typeof e?(m=e,e=null):m=e&&e.hasOwnProperty("constructor")?e.constructor:function(){return a.apply(this,arguments)};k.extend(!0,m,a,b||{});m.__super__=a.prototype;m.prototype=c(a.prototype);e&&k.extend(!0,m.prototype,e);return m},noop:b,bindFn:h,log:M,nextTick:function(){return function(a){setTimeout(a,1)}}(),slice:function(e){return function(){return a.apply(e,arguments)}}([].slice),guid:function(){var a=0;return function(e){for(var b=(+new Date).toString(32),m=0;5>m;m++)b+=Math.floor(65535*Math.random()).toString(32);return(e||"wu_")+b+(a++).toString(32)}}(),formatSize:function(a,e,b){var m;for(b=b||["B","K","M","G","TB"];(m=b.shift())&&1024<a;)a/=1024;return("B"===m?a:a.toFixed(e||2))+m}}});l("mediator",["base"],function(k){function g(a,m,f,d){return b.grep(a,function(a){return a&&(!m||a.e===m)&&(!f||a.cb===f||a.cb._cb===f)&&(!d||a.ctx===d)})}function h(a,m,d){b.each((a||"").split(f),function(a,e){d(e,m)})}function c(a,b){for(var f=!1,d=-1,c=a.length,h;++d<c;)if(h=a[d],!1===h.cb.apply(h.ctx2,b)){f=!0;break}return!f}var b=k.$,a=[].slice,f=/\s+/,d;d={on:function(a,b,f){var d=this,c;if(!b)return this;c=this._events||(this._events=[]);h(a,b,function(a,e){var b={e:a};b.cb=e;b.ctx=f;b.ctx2=f||d;b.id=c.length;c.push(b)});return this},once:function(a,b,f){var d=this;if(!b)return d;h(a,b,function(a,e){var b=function(){d.off(a,b);return e.apply(f||d,arguments)};b._cb=e;d.on(a,b,f)});return d},off:function(a,f,d){var c=this._events;if(!c)return this;if(!a&&!f&&!d)return this._events=[],this;h(a,f,function(a,e){b.each(g(c,a,e,d),function(){delete c[this.id]})});return this},trigger:function(e){var b,f,d;if(!this._events||!e)return this;b=a.call(arguments,1);f=g(this._events,e);d=g(this._events,"all");return c(f,b)&&c(d,arguments)}};return b.extend({installTo:function(a){return b.extend(a,d)}},d)});l("uploader",["base","mediator"],function(k,g){function h(b){this.options=c.extend(!0,{},h.options,b);this._init(this.options)}var c=k.$;h.options={};g.installTo(h.prototype);c.each({upload:"start-upload",stop:"stop-upload",getFile:"get-file",getFiles:"get-files",addFile:"add-file",addFiles:"add-file",sort:"sort-files",removeFile:"remove-file",skipFile:"skip-file",retry:"retry",isInProgress:"is-in-progress",makeThumb:"make-thumb",getDimension:"get-dimension",addButton:"add-btn",getRuntimeType:"get-runtime-type",refresh:"refresh",disable:"disable",enable:"enable",reset:"reset"},function(b,a){h.prototype[b]=function(){return this.request(a,arguments)}});c.extend(h.prototype,{state:"pending",_init:function(b){var a=this;a.request("init",b,function(){a.state="ready";a.trigger("ready")})},option:function(b,a){var f=this.options;if(1<arguments.length)c.isPlainObject(a)&&c.isPlainObject(f[b])?c.extend(f[b],a):f[b]=a;else return b?f[b]:f},getStats:function(){var b=this.request("get-stats");return{successNum:b.numOfSuccess,cancelNum:b.numOfCancel,invalidNum:b.numOfInvalid,uploadFailNum:b.numOfUploadFailed,queueNum:b.numOfQueue}},trigger:function(b){var a=[].slice.call(arguments,1),f=this.options,d="on"+b.substring(0,1).toUpperCase()+b.substring(1);return!1===g.trigger.apply(this,arguments)||c.isFunction(f[d])&&!1===f[d].apply(this,a)||c.isFunction(this[d])&&!1===this[d].apply(this,a)||!1===g.trigger.apply(g,[this,b].concat(a))?!1:!0},request:k.noop});k.create=h.create=function(b){return new h(b)};return k.Uploader=h});l("runtime/runtime",["base","mediator"],function(k,g){function h(a){this.options=c.extend({container:document.body},a);this.uid=k.guid("rt_")}var c=k.$,b={},a=function(a){for(var b in a)if(a.hasOwnProperty(b))return b;return null};c.extend(h.prototype,{getContainer:function(){var a,b;if(this._container)return this._container;a=c(this.options.container||document.body);b=c(document.createElement("div"));b.attr("id","rt_"+this.uid);b.css({position:"absolute",top:"0px",left:"0px",width:"1px",height:"1px",overflow:"hidden"});a.append(b);a.addClass("webuploader-container");return this._container=b},init:k.noop,exec:k.noop,destroy:function(){this._container&&this._container.parentNode.removeChild(this.__container);this.off()}});h.orders="html5,flash";h.addRuntime=function(a,d){b[a]=d};h.hasRuntime=function(f){return!(f?!b[f]:!a(b))};h.create=function(f,d){var e;d=d||h.orders;c.each(d.split(/\s*,\s*/g),function(){if(b[this])return e=this,!1});e=e||a(b);if(!e)throw Error("Runtime Error");return new b[e](f)};g.installTo(h.prototype);return h});l("runtime/client",["base","mediator","runtime/runtime"],function(k,g,h){function c(a,f){var d=k.Deferred(),e;this.uid=k.guid("client_");this.runtimeReady=function(a){return d.done(a)};this.connectRuntime=function(a,c){if(e)throw Error("already connected!");d.done(c);"string"===typeof a&&b.get(a)&&(e=b.get(a));(e=e||b.get(null,f))?(k.$.extend(e.options,a),e.__promise.then(d.resolve),e.__client++):(e=h.create(a,a.runtimeOrder),e.__promise=d.promise(),e.once("ready",d.resolve),e.init(),b.add(e),e.__client=1);f&&(e.__standalone=f);return e};this.getRuntime=function(){return e};this.disconnectRuntime=function(){e&&(e.__client--,0>=e.__client&&(b.remove(e),delete e.__promise,e.destroy()),e=null)};this.exec=function(){if(e){var b=k.slice(arguments);a&&b.unshift(a);return e.exec.apply(this,b)}};this.getRuid=function(){return e&&e.uid};this.destroy=function(a){return function(){a&&a.apply(this,arguments);this.trigger("destroy");this.off();this.exec("destroy");this.disconnectRuntime()}}(this.destroy)}var b;b=function(){var a={};return{add:function(b){a[b.uid]=b},get:function(b,d){var e;if(b)return a[b];for(e in a)if(!d||!a[e].__standalone)return a[e];return null},remove:function(b){delete a[b.uid]}}}();g.installTo(c.prototype);return c});l("lib/blob",["base","runtime/client"],function(k,g){function h(c,b){this.source=b;this.ruid=c;g.call(this,"Blob");this.uid=b.uid||this.uid;this.type=b.type||"";this.size=b.size||0;c&&this.connectRuntime(c)}k.inherits(g,{constructor:h,slice:function(c,b){return this.exec("slice",c,b)},getSource:function(){return this.source}});return h});l("lib/file",["base","lib/blob"],function(k,g){function h(a,f){var d;g.apply(this,arguments);this.name=f.name||"untitled"+c++;d=b.exec(f.name)?RegExp.$1.toLowerCase():"";!d&&this.type&&(d=/\/(jpg|jpeg|png|gif|bmp)$/i.exec(this.type)?RegExp.$1.toLowerCase():"",this.name+="."+d);!this.type&&~"jpg,jpeg,png,gif,bmp".indexOf(d)&&(this.type="image/"+("jpg"===d?"jpeg":d));this.ext=d;this.lastModifiedDate=f.lastModifiedDate||(new Date).toLocaleString()}var c=1,b=/\.([^.]+)$/;return k.inherits(g,h)});l("lib/filepicker",["base","runtime/client","lib/file"],function(k,g,h){function c(a){a=this.options=b.extend({},c.options,a);a.container=b(a.id);if(!a.container.length)throw Error("\u6309\u94ae\u6307\u5b9a\u9519\u8bef");a.innerHTML=a.innerHTML||a.label||a.container.html()||"";a.button=b(a.button||document.createElement("div"));a.button.html(a.innerHTML);a.container.html(a.button);g.call(this,"FilePicker",!0)}var b=k.$;c.options={button:null,container:null,label:null,innerHTML:null,multiple:!0,accept:null,name:"file"};k.inherits(g,{constructor:c,init:function(){var a=this,f=a.options,d=f.button;d.addClass("webuploader-pick");a.on("all",function(e){switch(e){case "mouseenter":d.addClass("webuploader-pick-hover");break;case "mouseleave":d.removeClass("webuploader-pick-hover");break;case "change":e=a.exec("getFiles"),a.trigger("select",b.map(e,function(e){e=new h(a.getRuid(),e);e._refer=f.container;return e}),f.container)}});a.connectRuntime(f,function(){a.refresh();a.exec("init",f);a.trigger("ready")});b(n).on("resize",function(){a.refresh()})},refresh:function(){var a=this.getRuntime().getContainer(),b=this.options.button,d=b.outerWidth?b.outerWidth():b.width(),e=b.outerHeight?b.outerHeight():b.height(),b=b.offset();d&&e&&a.css({bottom:"auto",right:"auto",width:d+"px",height:e+"px"}).offset(b)},enable:function(){this.options.button.removeClass("webuploader-pick-disable");this.refresh()},disable:function(){var a=this.options.button;this.getRuntime().getContainer().css({top:"-99999px"});a.addClass("webuploader-pick-disable")},destroy:function(){this.runtime&&(this.exec("destroy"),this.disconnectRuntime())}});return c});l("widgets/widget",["base","uploader"],function(k,g){function h(a){if(!a)return!1;var f=a.length,d=b.type(a);return 1===a.nodeType&&f?!0:"array"===d||"function"!==d&&"string"!==d&&(0===f||"number"===typeof f&&0<f&&f-1 in a)}function c(a){this.owner=a;this.options=a.options}var b=k.$,a=g.prototype._init,f={},d=[];b.extend(c.prototype,{init:k.noop,invoke:function(a,d){var c=this.responseMap;return c&&a in c&&c[a]in this&&b.isFunction(this[c[a]])?this[c[a]].apply(this,d):f},request:function(){return this.owner.request.apply(this.owner,arguments)}});b.extend(g.prototype,{_init:function(){var e=this,f=e._widgets=[];b.each(d,function(a,b){f.push(new b(e))});return a.apply(e,arguments)},request:function(a,b,d){var c=0,g=this._widgets,x=g.length,l=[],t=[],u;for(b=h(b)?b:[b];c<x;c++)u=g[c],u=u.invoke(a,b),u!==f&&(k.isPromise(u)?t.push(u):l.push(u));return d||t.length?(a=k.when.apply(k,t),b=a.pipe?"pipe":"then",a[b](function(){var a=k.Deferred(),b=arguments;setTimeout(function(){a.resolve.apply(a,b)},1);return a.promise()})[b](d||k.noop)):l[0]}});g.register=c.register=function(a,f){var p={init:"init"};1===arguments.length?(f=a,f.responseMap=p):f.responseMap=b.extend(p,a);p=k.inherits(c,f);d.push(p);return p};return c});l("widgets/filepicker",["base","uploader","lib/filepicker","widgets/widget"],function(k,g,h){var c=k.$;c.extend(g.options,{pick:null,accept:null});return g.register({"add-btn":"addButton",refresh:"refresh",disable:"disable",enable:"enable"},{init:function(b){this.pickers=[];return b.pick&&this.addButton(b.pick)},refresh:function(){c.each(this.pickers,function(){this.refresh()})},addButton:function(b){var a=this,f=a.options,d=f.accept,e;if(b)return e=k.Deferred(),c.isPlainObject(b)||(b={id:b}),b=c.extend({},b,{accept:c.isPlainObject(d)?[d]:d,swf:f.swf,runtimeOrder:f.runtimeOrder}),b=new h(b),b.once("ready",e.resolve),b.on("select",function(b){a.owner.request("add-file",[b])}),b.init(),this.pickers.push(b),e.promise()},disable:function(){c.each(this.pickers,function(){this.disable()})},enable:function(){c.each(this.pickers,function(){this.enable()})}})});l("lib/image",["base","runtime/client","lib/blob"],function(k,g,h){function c(a){this.options=b.extend({},c.options,a);g.call(this,"Image");this.on("load",function(){this._info=this.exec("info");this._meta=this.exec("meta")})}var b=k.$;c.options={quality:90,crop:!1,preserveHeaders:!0,allowMagnify:!0};k.inherits(g,{constructor:c,info:function(a){return a?(this._info=a,this):this._info},meta:function(a){return a?(this._meta=a,this):this._meta},loadFromBlob:function(a){var b=this,c=a.getRuid();this.connectRuntime(c,function(){b.exec("init",b.options);b.exec("loadFromBlob",a)})},resize:function(){var a=k.slice(arguments);return this.exec.apply(this,["resize"].concat(a))},getAsDataUrl:function(a){return this.exec("getAsDataUrl",a)},getAsBlob:function(a){a=this.exec("getAsBlob",a);return new h(this.getRuid(),a)}});return c});l("widgets/image",["base","uploader","lib/image","widgets/widget"],function(k,g,h){var c=k.$,b;b=function(a){var b=0,c=[],e=function(){for(var e;c.length&&b<a;)e=c.shift(),b+=e[0],e[1]()};return function(a,p,h){c.push([p,h]);a.once("destroy",function(){b-=p;setTimeout(e,1)});setTimeout(e,1)}}(5242880);c.extend(g.options,{thumb:{width:110,height:110,quality:70,allowMagnify:!0,crop:!0,preserveHeaders:!1,type:"image/jpeg"},compress:{width:1600,height:1600,quality:90,allowMagnify:!1,crop:!1,preserveHeaders:!0}});return g.register({"make-thumb":"makeThumb","before-send-file":"compressImage"},{makeThumb:function(a,f,d,e){var m,p;a=this.request("get-file",a);a.type.match(/^image/)?(m=c.extend({},this.options.thumb),c.isPlainObject(d)&&(m=c.extend(m,d),d=null),d=d||m.width,e=e||m.height,p=new h(m),p.once("load",function(){a._info=a._info||p.info();a._meta=a._meta||p.meta();p.resize(d,e)}),p.once("complete",function(){f(!1,p.getAsDataUrl(m.type));p.destroy()}),p.once("error",function(){f(!0);p.destroy()}),b(p,a.source.size,function(){a._info&&p.info(a._info);a._meta&&p.meta(a._meta);p.loadFromBlob(a.source)})):f(!0)},compressImage:function(a){var b=this.options.compress||this.options.resize,d=b&&b.compressSize||307200,e,m;a=this.request("get-file",a);if(b&&~"image/jpeg,image/jpg".indexOf(a.type)&&!(a.size<d)&&!a._compressed)return b=c.extend({},b),m=k.Deferred(),e=new h(b),m.always(function(){e.destroy();e=null}),e.once("error",m.reject),e.once("load",function(){a._info=a._info||e.info();a._meta=a._meta||e.meta();e.resize(b.width,b.height)}),e.once("complete",function(){var c,d;try{c=e.getAsBlob(b.type),d=a.size,c.size<d&&(a.source=c,a.size=c.size,a.trigger("resize",c.size,d)),a._compressed=!0,m.resolve()}catch(h){m.resolve()}}),a._info&&e.info(a._info),a._meta&&e.meta(a._meta),e.loadFromBlob(a.source),m.promise()}})});l("file",["base","mediator"],function(k,g){function h(f){this.name=f.name||"Untitled";this.size=f.size||0;this.type=f.type||"application";this.lastModifiedDate=f.lastModifiedDate||1*new Date;this.id="WU_FILE_"+c++;this.ext=b.exec(this.name)?RegExp.$1:"";this.statusText="";a[this.id]=h.Status.INITED;this.source=f;this.loaded=0;this.on("error",function(a){this.setStatus(h.Status.ERROR,a)})}var c=0,b=/\.([^.]+)$/,a={};k.$.extend(h.prototype,{setStatus:function(b,c){var e=a[this.id];"undefined"!==typeof c&&(this.statusText=c);b!==e&&(a[this.id]=b,this.trigger("statuschange",b,e))},getStatus:function(){return a[this.id]},getSource:function(){return this.source},destory:function(){delete a[this.id]}});g.installTo(h.prototype);h.Status={INITED:"inited",QUEUED:"queued",PROGRESS:"progress",ERROR:"error",COMPLETE:"complete",CANCELLED:"cancelled",INTERRUPT:"interrupt",INVALID:"invalid"};return h});l("queue",["base","mediator","file"],function(k,g,h){function c(){this.stats={numOfQueue:0,numOfSuccess:0,numOfCancel:0,numOfProgress:0,numOfUploadFailed:0,numOfInvalid:0};this._queue=[];this._map={}}var b=k.$,a=h.Status;b.extend(c.prototype,{append:function(a){this._queue.push(a);this._fileAdded(a);return this},prepend:function(a){this._queue.unshift(a);this._fileAdded(a);return this},getFile:function(a){return"string"!==typeof a?a:this._map[a]},fetch:function(b){var c=this._queue.length,e,m;b=b||a.QUEUED;for(e=0;e<c;e++)if(m=this._queue[e],b===m.getStatus())return m;return null},sort:function(a){"function"===typeof a&&this._queue.sort(a)},getFiles:function(){for(var a=[].slice.call(arguments,0),c=[],e=0,m=this._queue.length,p;e<m;e++)p=this._queue[e],a.length&&!~b.inArray(p.getStatus(),a)||c.push(p);return c},_fileAdded:function(b){var c=this;this._map[b.id]||(this._map[b.id]=b,b.on("statuschange",function(a,b){c._onFileStatusChange(a,b)}));b.setStatus(a.QUEUED)},_onFileStatusChange:function(b,c){var e=this.stats;switch(c){case a.PROGRESS:e.numOfProgress--;break;case a.QUEUED:e.numOfQueue--;break;case a.ERROR:e.numOfUploadFailed--;break;case a.INVALID:e.numOfInvalid--}switch(b){case a.QUEUED:e.numOfQueue++;break;case a.PROGRESS:e.numOfProgress++;break;case a.ERROR:e.numOfUploadFailed++;break;case a.COMPLETE:e.numOfSuccess++;break;case a.CANCELLED:e.numOfCancel++;break;case a.INVALID:e.numOfInvalid++}}});g.installTo(c.prototype);return c});l("widgets/queue","base uploader queue file lib/file runtime/client widgets/widget".split(" "),function(k,g,h,c,b,a){var f=k.$,d=/\.\w+$/,e=c.Status;return g.register({"sort-files":"sortFiles","add-file":"addFiles","get-file":"getFile","fetch-file":"fetchFile","get-stats":"getStats","get-files":"getFiles","remove-file":"removeFile",retry:"retry",reset:"reset","accept-file":"acceptFile"},{init:function(b){var e=this,c,d,g,l,t,u,n;f.isPlainObject(b.accept)&&(b.accept=[b.accept]);if(b.accept){t=[];g=0;for(d=b.accept.length;g<d;g++)(l=b.accept[g].extensions)&&t.push(l);t.length&&(u="\\."+t.join(",").replace(/,/g,"$|\\.").replace(/\*/g,".*")+"$");e.accept=new RegExp(u,"i")}e.queue=new h;e.stats=e.queue.stats;if("html5"===this.request("predict-runtime-type"))return c=k.Deferred(),n=new a("Placeholder"),n.connectRuntime({runtimeOrder:"html5"},function(){e._ruid=n.getRuid();c.resolve()}),c.promise()},_wrapFile:function(a){if(!(a instanceof c)){if(!(a instanceof b)){if(!this._ruid)throw Error("Can't add external files.");a=new b(this._ruid,a)}a=new c(a)}return a},acceptFile:function(a){return!(!a||6>a.size||this.accept&&d.exec(a.name)&&!this.accept.test(a.name))},_addFile:function(a){a=this._wrapFile(a);if(this.owner.trigger("beforeFileQueued",a)){if(this.acceptFile(a))return this.queue.append(a),this.owner.trigger("fileQueued",a),a;this.owner.trigger("error","Q_TYPE_DENIED",a)}},getFile:function(a){return this.queue.getFile(a)},addFiles:function(a){var b=this;a.length||(a=[a]);a=f.map(a,function(a){return b._addFile(a)});b.owner.trigger("filesQueued",a);b.options.auto&&b.request("start-upload")},getStats:function(){return this.stats},removeFile:function(a){a=a.id?a:this.queue.getFile(a);a.setStatus(e.CANCELLED);this.owner.trigger("fileDequeued",a)},getFiles:function(){return this.queue.getFiles.apply(this.queue,arguments)},fetchFile:function(){return this.queue.fetch.apply(this.queue,arguments)},retry:function(a,b){var c,d,f;if(a)a=a.id?a:this.queue.getFile(a),a.setStatus(e.QUEUED),b||this.request("start-upload");else{c=this.queue.getFiles(e.ERROR);d=0;for(f=c.length;d<f;d++)a=c[d],a.setStatus(e.QUEUED);this.request("start-upload")}},sortFiles:function(){return this.queue.sort.apply(this.queue,arguments)},reset:function(){this.queue=new h;this.stats=this.queue.stats}})});l("widgets/runtime",["uploader","runtime/runtime","widgets/widget"],function(k,g){k.support=function(){return g.hasRuntime.apply(g,arguments)};return k.register({"predict-runtime-type":"predictRuntmeType"},{init:function(){if(!this.predictRuntmeType())throw Error("Runtime Error");},predictRuntmeType:function(){var h=this.options.runtimeOrder||g.orders,c=this.type,b,a;if(!c)for(h=h.split(/\s*,\s*/g),b=0,a=h.length;b<a;b++)if(g.hasRuntime(h[b])){this.type=c=h[b];break}return c}})});l("lib/transport",["base","runtime/client","mediator"],function(k,g,h){function c(a){var f=this;a=f.options=b.extend(!0,{},c.options,a||{});g.call(this,"Transport");this._blob=null;this._formData=a.formData||{};this._headers=a.headers||{};this.on("progress",this._timeout);this.on("load error",function(){f.trigger("progress",1);clearTimeout(f._timer)})}var b=k.$;c.options={server:"",method:"POST",withCredentials:!1,fileVal:"file",timeout:12E4,formData:{},headers:{},sendAsBinary:!1};b.extend(c.prototype,{appendBlob:function(a,b,c){var e=this,m=e.options;e.getRuid()&&e.disconnectRuntime();e.connectRuntime(b.ruid,function(){e.exec("init")});e._blob=b;m.fileVal=a||m.fileVal;m.filename=c||m.filename},append:function(a,c){"object"===typeof a?b.extend(this._formData,a):this._formData[a]=c},setRequestHeader:function(a,c){"object"===typeof a?b.extend(this._headers,a):this._headers[a]=c},send:function(a){this.exec("send",a);this._timeout()},abort:function(){clearTimeout(this._timer);return this.exec("abort")},destroy:function(){this.trigger("destroy");this.off();this.exec("destroy");this.disconnectRuntime()},getResponse:function(){return this.exec("getResponse")},getResponseAsJson:function(){return this.exec("getResponseAsJson")},getStatus:function(){return this.exec("getStatus")},_timeout:function(){var a=this,b=a.options.timeout;b&&(clearTimeout(a._timer),a._timer=setTimeout(function(){a.abort();a.trigger("error","timeout")},b))}});h.installTo(c.prototype);return c});l("widgets/upload",["base","uploader","file","lib/transport","widgets/widget"],function(k,g,h,c){function b(a,b){for(var c=[],d=a.source.size,f=b?Math.ceil(d/b):1,h=0,k=0,g;k<f;)g=Math.min(b,d-h),c.push({file:a,start:h,end:b?h+g:d,total:d,chunks:f,chunk:k++}),h+=g;a.blocks=c.concat();a.remaning=c.length;return{file:a,has:function(){return!!c.length},fetch:function(){return c.shift()}}}var a=k.$,f=k.isPromise,d=h.Status;a.extend(g.options,{prepareNextFile:!1,chunked:!1,chunkSize:5242880,chunkRetry:2,threads:3,formData:null});g.register({"start-upload":"start","stop-upload":"stop","skip-file":"skipFile","is-in-progress":"isInProgress"},{init:function(){var b=this.owner;this.runing=!1;this.pool=[];this.pending=[];this.remaning=0;this.__tick=k.bindFn(this._tick,this);b.on("uploadComplete",function(b){b.blocks&&a.each(b.blocks,function(a,b){b.transport&&(b.transport.abort(),b.transport.destroy());delete b.transport});delete b.blocks;delete b.remaning})},start:function(){var b=this;a.each(b.request("get-files",d.INVALID),function(){b.request("remove-file",this)});b.runing||(b.runing=!0,a.each(b.pool,function(a,c){var f=c.file;f.getStatus()===d.INTERRUPT&&(f.setStatus(d.PROGRESS),b._trigged=!1,c.transport&&c.transport.send())}),b._trigged=!1,b.owner.trigger("startUpload"),k.nextTick(b.__tick))},stop:function(b){!1!==this.runing&&(this.runing=!1,b&&a.each(this.pool,function(a,b){b.transport&&b.transport.abort();b.file.setStatus(d.INTERRUPT)}),this.owner.trigger("stopUpload"))},isInProgress:function(){return!!this.runing},getStats:function(){return this.request("get-stats")},skipFile:function(b,c){b=this.request("get-file",b);b.setStatus(c||d.COMPLETE);b.skipped=!0;b.blocks&&a.each(b.blocks,function(a,b){var e=b.transport;e&&(e.abort(),e.destroy(),delete b.transport)});this.owner.trigger("uploadSkip",b)},_tick:function(){var a=this,b=a.options,c;if(a._promise)return a._promise.always(a.__tick);a.pool.length<b.threads&&(c=a._nextBlock())?(a._trigged=!1,b=function(b){a._promise=null;b&&b.file&&a._startSend(b);k.nextTick(a.__tick)},a._promise=f(c)?c.always(b):b(c)):a.remaning||a.getStats().numOfQueue||(a.runing=!1,a._trigged||k.nextTick(function(){a.owner.trigger("uploadFinished")}),a._trigged=!0)},_nextBlock:function(){var a=this,c=a._act,h=a.options,k,g;if(c&&c.has()&&c.file.getStatus()===d.PROGRESS)return h.prepareNextFile&&!a.pending.length&&a._prepareNextFile(),c.fetch();if(a.runing)return!a.pending.length&&a.getStats().numOfQueue&&a._prepareNextFile(),k=a.pending.shift(),g=function(d){if(!d)return null;c=b(d,h.chunked?h.chunkSize:0);a._act=c;return c.fetch()},f(k)?k[k.pipe?"pipe":"then"](g):g(k)},_prepareNextFile:function(){var b=this,c=b.request("fetch-file"),f=b.pending,h;c&&(h=b.request("before-send-file",c,function(){return c.getStatus()===d.QUEUED?(b.owner.trigger("uploadStart",c),c.setStatus(d.PROGRESS),c):b._finishFile(c)}),h.done(function(){var b=a.inArray(h,f);~b&&f.splice(b,1,c)}),h.fail(function(a){c.setStatus(d.ERROR,a);b.owner.trigger("uploadError",c,a);b.owner.trigger("uploadComplete",c)}),f.push(h))},_popBlock:function(b){var c=a.inArray(b,this.pool);this.pool.splice(c,1);b.file.remaning--;this.remaning--},_startSend:function(a){var b=this,c=a.file;b.pool.push(a);b.remaning++;a.blob=1===a.chunks?c.source:c.source.slice(a.start,a.end);b.request("before-send",a,function(){c.getStatus()===d.PROGRESS?b._doSend(a):(b._popBlock(a),k.nextTick(b.__tick))}).fail(function(){1===c.remaning?b._finishFile(c).always(function(){a.percentage=1;b._popBlock(a);b.owner.trigger("uploadComplete",c);k.nextTick(b.__tick)}):(a.percentage=1,b._popBlock(a),k.nextTick(b.__tick))})},_doSend:function(b){var f=this,h=f.owner,g=f.options,l=b.file,x=new c(g),n=a.extend({},g.formData),t=a.extend({},g.headers),u,B;b.transport=x;x.on("destroy",function(){delete b.transport;f._popBlock(b);k.nextTick(f.__tick)});x.on("progress",function(c){var d=0,f=0,d=b.percentage=c;1<b.chunks&&(a.each(l.blocks,function(a,b){f+=(b.percentage||0)*(b.end-b.start)}),d=f/l.size);h.trigger("uploadProgress",l,d||0)});u=function(a){B=x.getResponseAsJson()||{};B._raw=x.getResponse();h.trigger("uploadAccept",b,B,function(b){a=b})||(a=a||"server");return a};x.on("error",function(a,c){b.retried=b.retried||0;1<b.chunks&&~"http,abort".indexOf(a)&&b.retried<g.chunkRetry?(b.retried++,x.send()):(c||"server"!==a||(a=u(a)),l.setStatus(d.ERROR,a),h.trigger("uploadError",l,a),h.trigger("uploadComplete",l))});x.on("load",function(){var a;(a=u())?x.trigger("error",a,!0):1===l.remaning?f._finishFile(l,B):x.destroy()});n=a.extend(n,{id:l.id,name:l.name,type:l.type,lastModifiedDate:l.lastModifiedDate,size:l.size});1<b.chunks&&a.extend(n,{chunks:b.chunks,chunk:b.chunk});h.trigger("uploadBeforeSend",b,n,t);x.appendBlob(g.fileVal,b.blob,l.name);x.append(n);x.setRequestHeader(t);x.send()},_finishFile:function(a,b,c){var f=this.owner;return f.request("after-send-file",arguments,function(){a.setStatus(d.COMPLETE);f.trigger("uploadSuccess",a,b,c)}).fail(function(b){a.getStatus()===d.PROGRESS&&a.setStatus(d.ERROR,b);f.trigger("uploadError",a,b)}).always(function(){f.trigger("uploadComplete",a)})}})});l("runtime/compbase",[],function(){return function(k,g){this.owner=k;this.options=k.options;this.getRuntime=function(){return g};this.getRuid=function(){return g.uid};this.trigger=function(){return k.trigger.apply(k,arguments)}}});l("runtime/html5/runtime",["base","runtime/runtime","runtime/compbase"],function(k,g,h){function c(){var a={},c=this,d=this.destory;g.apply(c,arguments);c.type="html5";c.exec=function(d,h){var g=this.uid,l=k.slice(arguments,2);if(b[d]&&(g=a[g]=a[g]||new b[d](this,c),g[h]))return g[h].apply(g,l)};c.destory=function(){return d&&d.apply(this,arguments)}}var b={};k.inherits(g,{constructor:c,init:function(){var a=this;setTimeout(function(){a.trigger("ready")},1)}});c.register=function(a,c){return b[a]=k.inherits(h,c)};n.Blob&&n.FileReader&&n.DataView&&g.addRuntime("html5",c);return c});l("runtime/html5/blob",["runtime/html5/runtime","lib/blob"],function(k,g){return k.register("Blob",{slice:function(h,c){var b=this.owner.source,b=(b.slice||b.webkitSlice||b.mozSlice).call(b,h,c);return new g(this.getRuid(),b)}})});l("runtime/html5/filepicker",["base","runtime/html5/runtime"],function(k,g){var h=k.$;return g.register("FilePicker",{init:function(){var c=this.getRuntime().getContainer(),b=this,a=b.owner,f=b.options,d=h(document.createElement("label")),e=h(document.createElement("input")),k,g,l,n;e.attr("type","file");e.attr("name",f.name);e.addClass("webuploader-element-invisible");d.on("click",function(){e.trigger("click")});d.css({opacity:0,width:"100%",height:"100%",display:"block",cursor:"pointer",background:"#ffffff"});f.multiple&&e.attr("multiple","multiple");if(f.accept&&0<f.accept.length){k=[];g=0;for(l=f.accept.length;g<l;g++)k.push(f.accept[g].mimeTypes);e.attr("accept",k.join(","))}c.append(e);c.append(d);n=function(b){a.trigger(b.type)};e.on("change",function(c){var d=arguments.callee,f;b.files=c.target.files;f=this.cloneNode(!0);this.parentNode.replaceChild(f,this);e.off();e=h(f).on("change",d).on("mouseenter mouseleave",n);a.trigger("change")});d.on("mouseenter mouseleave",n)},getFiles:function(){return this.files},destroy:function(){}})});l("runtime/html5/util",["base"],function(k){var g=n.createObjectURL&&n||n.URL&&URL.revokeObjectURL&&URL||n.webkitURL,h=k=k.noop;g&&(k=function(){return g.createObjectURL.apply(g,arguments)},h=function(){return g.revokeObjectURL.apply(g,arguments)});return{createObjectURL:k,revokeObjectURL:h,dataURL2Blob:function(c){var b,a,f,d;d=c.split(",");b=~d[0].indexOf("base64")?atob(d[1]):decodeURIComponent(d[1]);c=new ArrayBuffer(b.length);a=new Uint8Array(c);for(f=0;f<b.length;f++)a[f]=b.charCodeAt(f);b=d[0].split(":")[1].split(";")[0];return this.arrayBufferToBlob(c,b)},dataURL2ArrayBuffer:function(c){var b,a;c=c.split(",");c=~c[0].indexOf("base64")?atob(c[1]):decodeURIComponent(c[1]);b=new Uint8Array(c.length);for(a=0;a<c.length;a++)b[a]=c.charCodeAt(a);return b.buffer},arrayBufferToBlob:function(c,b){var a=n.BlobBuilder||n.WebKitBlobBuilder;return a?(a=new a,a.append(c),a.getBlob(b)):new Blob([c],b?{type:b}:{})},canvasToDataUrl:function(c,b,a){return c.toDataURL(b,a/100)},parseMeta:function(c,b){b(!1,{})},updateImageHead:function(c){return c}}});l("runtime/html5/imagemeta",["runtime/html5/util"],function(k){var g;g={parsers:{65505:[]},maxMetaDataSize:262144,parse:function(h,c){var b=this,a=new FileReader;a.onload=function(){c(!1,b._parse(this.result));a=a.onload=a.onerror=null};a.onerror=function(b){c(b.message);a=a.onload=a.onerror=null};h=h.slice(0,b.maxMetaDataSize);a.readAsArrayBuffer(h.getSource())},_parse:function(h,c){if(!(6>h.byteLength)){var b=new DataView(h),a=2,f=b.byteLength-4,d=a,e={},k,p;if(65496===b.getUint16(0)){for(;a<f;)if(k=b.getUint16(a),65504<=k&&65519>=k||65534===k){p=b.getUint16(a+2)+2;if(a+p>b.byteLength)break;d=g.parsers[k];if(!c&&d)for(k=0;k<d.length;k+=1)d[k].call(g,b,a,p,e);d=a+=p}else break;6<d&&(e.imageHead=h.slice?h.slice(2,d):(new Uint8Array(h)).subarray(2,d))}return e}},updateImageHead:function(h,c){var b=this._parse(h,!0),a;a=2;b.imageHead&&(a=2+b.imageHead.byteLength);a=h.slice?h.slice(a):(new Uint8Array(h)).subarray(a);b=new Uint8Array(c.byteLength+2+a.byteLength);b[0]=255;b[1]=216;b.set(new Uint8Array(c),2);b.set(new Uint8Array(a),c.byteLength+2);return b.buffer}};k.parseMeta=function(){return g.parse.apply(g,arguments)};k.updateImageHead=function(){return g.updateImageHead.apply(g,arguments)};return g});l("runtime/html5/imagemeta/exif",["base","runtime/html5/imagemeta"],function(k,g){var h={ExifMap:function(){return this}};h.ExifMap.prototype.map={Orientation:274};h.ExifMap.prototype.get=function(c){return this[c]||this[this.map[c]]};h.exifTagTypes={1:{getValue:function(c,b){return c.getUint8(b)},size:1},2:{getValue:function(c,b){return String.fromCharCode(c.getUint8(b))},size:1,ascii:!0},3:{getValue:function(c,b,a){return c.getUint16(b,a)},size:2},4:{getValue:function(c,b,a){return c.getUint32(b,a)},size:4},5:{getValue:function(c,b,a){return c.getUint32(b,a)/c.getUint32(b+4,a)},size:8},9:{getValue:function(c,b,a){return c.getInt32(b,a)},size:4},10:{getValue:function(c,b,a){return c.getInt32(b,a)/c.getInt32(b+4,a)},size:8}};h.exifTagTypes[7]=h.exifTagTypes[1];h.getExifValue=function(c,b,a,f,d,e){f=h.exifTagTypes[f];var g,p;if(f)if(g=f.size*d,p=4<g?b+c.getUint32(a+8,e):a+8,p+g>c.byteLength)k.log("Invalid Exif data: Invalid data offset.");else{if(1===d)return f.getValue(c,p,e);b=[];for(a=0;a<d;a+=1)b[a]=f.getValue(c,p+a*f.size,e);if(f.ascii){c="";for(a=0;a<b.length;a+=1){d=b[a];if("\x00"===d)break;c+=d}return c}return b}else k.log("Invalid Exif data: Invalid tag type.")};h.parseExifTag=function(c,b,a,f,d){var e=c.getUint16(a,f);d.exif[e]=h.getExifValue(c,b,a,c.getUint16(a+2,f),c.getUint32(a+4,f),f)};h.parseExifTags=function(c,b,a,f,d){var e,h,g;if(a+6>c.byteLength)k.log("Invalid Exif data: Invalid directory offset.");else if(e=c.getUint16(a,f),h=a+2+12*e,h+4>c.byteLength)k.log("Invalid Exif data: Invalid directory size.");else{for(g=0;g<e;g+=1)this.parseExifTag(c,b,a+2+12*g,f,d);return c.getUint32(h,f)}};h.parseExifData=function(c,b,a,f){a=b+10;var d;if(1165519206===c.getUint32(b+4))if(a+8>c.byteLength)k.log("Invalid Exif data: Invalid segment size.");else if(0!==c.getUint16(b+8))k.log("Invalid Exif data: Missing byte alignment offset.");else{switch(c.getUint16(a)){case 18761:b=!0;break;case 19789:b=!1;break;default:k.log("Invalid Exif data: Invalid byte alignment marker.");return}42!==c.getUint16(a+2,b)?k.log("Invalid Exif data: Missing TIFF marker."):(d=c.getUint32(a+4,b),f.exif=new h.ExifMap,h.parseExifTags(c,a,a+d,b,f))}};g.parsers[65505].push(h.parseExifData);return h});l("runtime/html5/image",["base","runtime/html5/runtime","runtime/html5/util"],function(k,g,h){return g.register("Image",{modified:!1,init:function(){var c=this,b=new Image;b.onload=function(){c._info={type:c.type,width:this.width,height:this.height};c._metas||"image/jpeg"!==c.type?c.owner.trigger("load"):h.parseMeta(c._blob,function(a,b){c._metas=b;c.owner.trigger("load")})};b.onerror=function(){c.owner.trigger("error")};c._img=b},loadFromBlob:function(c){var b=this._img;this._blob=c;this.type=c.type;b.src=h.createObjectURL(c.getSource());this.owner.once("load",function(){h.revokeObjectURL(b.src)})},resize:function(c,b){var a=this._canvas||(this._canvas=document.createElement("canvas"));this._resize(this._img,a,c,b);this._blob=null;this.modified=!0;this.owner.trigger("complete")},getAsBlob:function(c){var b=this._blob,a=this.options;c=c||this.type;if(this.modified||this.type!==c){b=this._canvas;if("image/jpeg"===c){if(b=h.canvasToDataUrl(b,"image/jpeg",a.quality),a.preserveHeaders&&this._metas&&this._metas.imageHead)return b=h.dataURL2ArrayBuffer(b),b=h.updateImageHead(b,this._metas.imageHead),b=h.arrayBufferToBlob(b,c)}else b=h.canvasToDataUrl(b,c);b=h.dataURL2Blob(b)}return b},getAsDataUrl:function(c){var b=this.options;c=c||this.type;return"image/jpeg"===c?h.canvasToDataUrl(this._canvas,c,b.quality):this._canvas.toDataURL(c)},getOrientation:function(){return this._metas&&this._metas.exif&&this._metas.exif.get("Orientation")||1},info:function(c){return c?(this._info=c,this):this._info},meta:function(c){return c?(this._meta=c,this):this._meta},destroy:function(){var c=this._canvas;this._img.onload=null;c&&(c.getContext("2d").clearRect(0,0,c.width,c.height),c.width=c.height=0,this._canvas=null);this._img.src="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs%3D";this._img=this._blob=null},_resize:function(c,b,a,f){var d=this.options,e=c.width,h=c.height,k=this.getOrientation(),g;~[5,6,7,8].indexOf(k)&&(a^=f,f^=a,a^=f);g=Math[d.crop?"max":"min"](a/e,f/h);d.allowMagnify||(g=Math.min(1,g));e*=g;h*=g;d.crop?(b.width=a,b.height=f):(b.width=e,b.height=h);a=(b.width-e)/2;f=(b.height-h)/2;d.preserveHeaders||this._rotate2Orientaion(b,k);this._renderImageToCanvas(b,c,a,f,e,h)},_rotate2Orientaion:function(c,b){var a=c.width,f=c.height,d=c.getContext("2d");switch(b){case 5:case 6:case 7:case 8:c.width=f,c.height=a}switch(b){case 2:d.translate(a,0);d.scale(-1,1);break;case 3:d.translate(a,f);d.rotate(Math.PI);break;case 4:d.translate(0,f);d.scale(1,-1);break;case 5:d.rotate(.5*Math.PI);d.scale(1,-1);break;case 6:d.rotate(.5*Math.PI);d.translate(0,-f);break;case 7:d.rotate(.5*Math.PI);d.translate(a,-f);d.scale(-1,1);break;case 8:d.rotate(-.5*Math.PI),d.translate(-a,0)}},_renderImageToCanvas:function(){function c(b,a,c){var d=document.createElement("canvas"),e=d.getContext("2d");a=0;var h=c,k=c;d.width=1;d.height=c;e.drawImage(b,0,0);for(b=e.getImageData(0,0,1,c).data;k>a;)d=b[4*(k-1)+3],0===d?h=k:a=k,k=h+a>>1;c=k/c;return 0===c?1:c}return k.os.ios?7<=k.os.ios?function(b,a,f,d,e,h){var k=a.naturalWidth,g=a.naturalHeight,l=c(a,k,g);return b.getContext("2d").drawImage(a,0,0,k*l,g*l,f,d,e,h)}:function(b,a,f,d,e,h){var k=a.naturalWidth,g=a.naturalHeight;b=b.getContext("2d");var l;var n=a.naturalWidth,A;1048576<n*a.naturalHeight?(A=document.createElement("canvas"),A.width=A.height=1,A=A.getContext("2d"),A.drawImage(a,-n+1,0),l=0===A.getImageData(0,0,1,1).data[3]):l=!1;var t="image/jpeg"===this.type;A=n=0;var u,B;l&&(k/=2,g/=2);b.save();l=document.createElement("canvas");l.width=l.height=1024;u=l.getContext("2d");t=t?c(a,k,g):1;e=Math.ceil(1024*e/k);for(h=Math.ceil(1024*h/g/t);n<g;){for(B=t=0;t<k;)u.clearRect(0,0,1024,1024),u.drawImage(a,-t,-n),b.drawImage(l,0,0,1024,1024,f+B,d+A,e,h),t+=1024,B+=e;n+=1024;A+=h}b.restore()}:function(b,a,c,d,e,h){b.getContext("2d").drawImage(a,c,d,e,h)}}()})});l("runtime/html5/jpegencoder",[],function(k,g,h){function c(b){function a(a,b){for(var c=0,d=0,e=[],f=1;16>=f;f++){for(var h=1;h<=a[f];h++)e[b[d]]=[],e[b[d]][0]=c,e[b[d]][1]=f,d++,c++;c*=2}return e}function c(a){var b=a[0];for(a=a[1]-1;0<=a;)b&1<<a&&(J|=1<<G),a--,G--,0>G&&(255==J?(d(255),d(0)):d(J),G=7,J=0)}function d(a){P.push(S[a])}function e(a){d(a>>8&255);d(a&255)}function h(a,b,d,e,k){var g=k[0],l=k[240],m,p,n,v,t,r,w,u,y,q=0;for(m=0;8>m;++m){p=a[q];n=a[q+1];v=a[q+2];t=a[q+3];r=a[q+4];w=a[q+5];u=a[q+6];y=a[q+7];var x=p+y;p-=y;y=n+u;n-=u;u=v+w;v-=w;w=t+r;t-=r;r=x+w;x-=w;w=y+u;y-=u;a[q]=r+w;a[q+4]=r-w;r=.707106781*(y+x);a[q+2]=x+r;a[q+6]=x-r;r=t+v;w=v+n;y=n+p;v=.382683433*(r-y);t=.5411961*r+v;r=1.306562965*y+v;w*=.707106781;v=p+w;p-=w;a[q+5]=p+t;a[q+3]=p-t;a[q+1]=v+r;a[q+7]=v-r;q+=8}for(m=q=0;8>m;++m)p=a[q],n=a[q+8],v=a[q+16],t=a[q+24],r=a[q+32],w=a[q+40],u=a[q+48],y=a[q+56],x=p+y,p-=y,y=n+u,n-=u,u=v+w,v-=w,w=t+r,t-=r,r=x+w,x-=w,w=y+u,y-=u,a[q]=r+w,a[q+32]=r-w,r=.707106781*(y+x),a[q+16]=x+r,a[q+48]=x-r,r=t+v,w=v+n,y=n+p,v=.382683433*(r-y),t=.5411961*r+v,r=1.306562965*y+v,w*=.707106781,v=p+w,p-=w,a[q+40]=p+t,a[q+24]=p-t,a[q+8]=v+r,a[q+56]=v-r,q++;for(m=0;64>m;++m)q=a[m]*b[m],R[m]=0<q?q+.5|0:q-.5|0;a=R;for(b=0;64>b;++b)F[D[b]]=a[b];a=F[0]-d;d=F[0];0==a?c(e[0]):(m=32767+a,c(e[N[m]]),c(C[m]));for(e=63;0<e&&0==F[e];e--);if(0==e)return c(g),d;for(a=1;a<=e;){for(b=a;0==F[a]&&a<=e;++a);b=a-b;if(16<=b){m=b>>4;for(q=1;q<=m;++q)c(l);b&=15}m=32767+F[a];c(k[(b<<4)+N[m]]);c(C[m]);a++}63!=e&&c(g);return d}function k(a){0>=a&&(a=1);100<a&&(a=100);if(T!=a){for(var b=50>a?Math.floor(5E3/a):Math.floor(200-2*a),c=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],d=0;64>d;d++){var e=g((c[d]*b+50)/100);1>e?e=1:255<e&&(e=255);l[D[d]]=e}c=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99];for(d=0;64>d;d++)e=g((c[d]*b+50)/100),1>e?e=1:255<e&&(e=255),n[D[d]]=e;b=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379];for(d=c=0;8>d;d++)for(e=0;8>e;e++)A[c]=1/(l[D[c]]*b[d]*b[e]*8),t[c]=1/(n[D[c]]*b[d]*b[e]*8),c++;T=a}}var g=Math.floor,l=Array(64),n=Array(64),A=Array(64),t=Array(64),u,B,E,Q,C=Array(65535),N=Array(65535),R=Array(64),F=Array(64),P=[],J=0,G=7,U=Array(64),V=Array(64),W=Array(64),S=Array(256),z=Array(2048),T,D=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],X=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],Y=[0,1,2,3,4,5,6,7,8,9,10,11],Z=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],aa=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],ba=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],ca=[0,1,2,3,4,5,6,7,8,9,10,11],da=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],ea=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];this.encode=function(a,b){b&&k(b);P=[];J=0;G=7;e(65496);e(65504);e(16);d(74);d(70);d(73);d(70);d(0);d(1);d(1);d(0);e(1);e(1);d(0);d(0);e(65499);e(132);d(0);for(var g=0;64>g;g++)d(l[g]);d(1);for(g=0;64>g;g++)d(n[g]);var g=a.width,O=a.height;e(65472);e(17);d(8);e(O);e(g);d(3);d(1);d(17);d(0);d(2);d(17);d(1);d(3);d(17);d(1);e(65476);e(418);d(0);for(g=0;16>g;g++)d(X[g+1]);for(g=0;11>=g;g++)d(Y[g]);d(16);for(g=0;16>g;g++)d(Z[g+1]);for(g=0;161>=g;g++)d(aa[g]);d(1);for(g=0;16>g;g++)d(ba[g+1]);for(g=0;11>=g;g++)d(ca[g]);d(17);for(g=0;16>g;g++)d(da[g+1]);for(g=0;161>=g;g++)d(ea[g]);e(65498);e(12);d(3);d(1);d(0);d(2);d(17);d(3);d(17);d(0);d(63);d(0);var M=O=g=0;J=0;G=7;this.encode.displayName="_encode_";for(var C=a.data,F=a.height,K=4*a.width,L,D=0,v,H,r,w,I;D<F;){for(L=0;L<K;){w=K*D+L;for(I=0;64>I;I++)H=I>>3,v=4*(I&7),r=w+H*K+v,D+H>=F&&(r-=K*(D+1+H-F)),L+v>=K&&(r-=L+v-K+4),v=C[r++],H=C[r++],r=C[r++],U[I]=(z[v]+z[H+256>>0]+z[r+512>>0]>>16)-128,V[I]=(z[v+768>>0]+z[H+1024>>0]+z[r+1280>>0]>>16)-128,W[I]=(z[v+1280>>0]+z[H+1536>>0]+z[r+1792>>0]>>16)-128;g=h(U,A,g,u,E);O=h(V,t,O,B,Q);M=h(W,t,M,B,Q);L+=32}D+=8}0<=G&&(g=[],g[1]=G+1,g[0]=(1<<G+1)-1,c(g));e(65497);g="data:image/jpeg;base64,"+btoa(P.join(""));P=[];return g};b||(b=50);(function(){for(var a=String.fromCharCode,b=0;256>b;b++)S[b]=a(b)})();u=a(X,Y);B=a(ba,ca);E=a(Z,aa);Q=a(da,ea);(function(){for(var a=1,b=2,c=1;15>=c;c++){for(var d=a;d<b;d++)N[32767+d]=c,C[32767+d]=[],C[32767+d][1]=c,C[32767+d][0]=d;for(d=-(b-1);d<=-a;d++)N[32767+d]=c,C[32767+d]=[],C[32767+d][1]=c,C[32767+d][0]=b-1+d;a<<=1;b<<=1}})();(function(){for(var a=0;256>a;a++)z[a]=19595*a,z[a+256>>0]=38470*a,z[a+512>>0]=7471*a+32768,z[a+768>>0]=-11059*a,z[a+1024>>0]=-21709*a,z[a+1280>>0]=32768*a+8421375,z[a+1536>>0]=-27439*a,z[a+1792>>0]=-5329*a})();k(b)}c.encode=function(b,a){return(new c(a)).encode(b)};return c});l("runtime/html5/androidpatch",["runtime/html5/util","runtime/html5/jpegencoder","base"],function(k,g,h){var c=k.canvasToDataUrl,b;k.canvasToDataUrl=function(a,f,d){var e,k,l;if(!h.os.android)return c.apply(null,arguments);"image/jpeg"===f&&"undefined"===typeof b&&(e=c.apply(null,arguments),e=e.split(","),e=~e[0].indexOf("base64")?atob(e[1]):decodeURIComponent(e[1]),e=e.substring(0,2),b=255===e.charCodeAt(0)&&216===e.charCodeAt(1));return"image/jpeg"!==f||b?c.apply(null,arguments):(k=a.width,l=a.height,e=a.getContext("2d"),g.encode(e.getImageData(0,0,k,l),d))}});l("runtime/html5/transport",["base","runtime/html5/runtime"],function(k,g){var h=k.noop,c=k.$;return g.register("Transport",{init:function(){this._status=0;this._response=null},send:function(){var b=this.owner,a=this.options,f=this._initAjax(),d=b._blob,e=a.server,g,h,l;a.sendAsBinary?(e+=(/\?/.test(e)?"\x26":"?")+c.param(b._formData),h=d.getSource()):(g=new FormData,c.each(b._formData,function(a,b){g.append(a,b)}),g.append(a.fileVal,d.getSource(),a.filename||b._formData.name||""));a.withCredentials&&"withCredentials"in f?(f.open(a.method,e,!0),f.withCredentials=!0):f.open(a.method,e);this._setRequestHeader(f,a.headers);h?(f.overrideMimeType("application/octet-stream"),k.os.android?(l=new FileReader,l.onload=function(){f.send(this.result);l=l.onload=null},l.readAsArrayBuffer(h)):f.send(h)):f.send(g)},getResponse:function(){return this._response},getResponseAsJson:function(){return this._parseJson(this._response)},getStatus:function(){return this._status},abort:function(){var b=this._xhr;b&&(b.upload.onprogress=h,b.onreadystatechange=h,b.abort(),this._xhr=null)},destroy:function(){this.abort()},_initAjax:function(){var b=this,a=new XMLHttpRequest;!this.options.withCredentials||"withCredentials"in a||"undefined"===typeof XDomainRequest||(a=new XDomainRequest);a.upload.onprogress=function(a){var c=0;a.lengthComputable&&(c=a.loaded/a.total);return b.trigger("progress",c)};a.onreadystatechange=function(){if(4===a.readyState)return a.upload.onprogress=h,a.onreadystatechange=h,b._xhr=null,b._status=a.status,200<=a.status&&300>a.status?(b._response=a.responseText,b.trigger("load")):500<=a.status&&600>a.status?(b._response=a.responseText,b.trigger("error","server")):b.trigger("error",b._status?"http":"abort")};return b._xhr=a},_setRequestHeader:function(b,a){c.each(a,function(a,c){b.setRequestHeader(a,c)})},_parseJson:function(b){var a;try{a=JSON.parse(b)}catch(c){a={}}return a}})});l("webuploader","base widgets/filepicker widgets/image widgets/queue widgets/runtime widgets/upload runtime/html5/blob runtime/html5/filepicker runtime/html5/imagemeta/exif runtime/html5/image runtime/html5/androidpatch runtime/html5/transport".split(" "),function(k){return k});return E("webuploader")});